/** 

ğŸ‡«â€ŒğŸ‡±â€ŒğŸ‡¦â€ŒğŸ‡¸â€ŒğŸ‡­â€Œ-ğŸ‡²â€ŒğŸ‡©â€Œ 

  ğ—–ğ—¼ğ—½ğ˜†ğ—¿ğ—¶ğ—´ğ—µğ˜ (ğ—–) 2024.
 ğ—Ÿğ—¶ğ—°ğ—²ğ—»ğ˜€ğ—²ğ—± ğ˜‚ğ—»ğ—±ğ—²ğ—¿ ğ˜ğ—µğ—²  ğ— ğ—œğ—§ ğ—Ÿğ—¶ğ—°ğ—²ğ—»ğ˜€ğ—²;
 ğ—¬ğ—¼ğ˜‚ ğ—ºğ—®ğ˜† ğ—»ğ—¼ğ˜ ğ˜‚ğ˜€ğ—² ğ˜ğ—µğ—¶ğ˜€ ğ—³ğ—¶ğ—¹ğ—² ğ—²ğ˜…ğ—°ğ—²ğ—½ğ˜ ğ—¶ğ—» ğ—°ğ—¼ğ—ºğ—½ğ—¹ğ—¶ğ—®ğ—»ğ—°ğ—² ğ˜„ğ—¶ğ˜ğ—µ ğ˜ğ—µğ—² ğ—Ÿğ—¶ğ—°ğ—²ğ—»ğ˜€ğ—².
 ğ—œğ˜ ğ—¶ğ˜€ ğ˜€ğ˜‚ğ—½ğ—½ğ—¹ğ—¶ğ—²ğ—± ğ—¶ğ—» ğ˜ğ—µğ—² ğ—µğ—¼ğ—½ğ—² ğ˜ğ—µğ—®ğ˜ ğ—¶ğ˜ ğ—ºğ—®ğ˜† ğ—¯ğ—² ğ˜‚ğ˜€ğ—²ğ—³ğ˜‚ğ—¹.
 * @ğ—½ğ—¿ğ—¼ğ—·ğ—²ğ—°ğ˜_ğ—»ğ—®ğ—ºğ—² : ğ—™ğ—¹ğ—®ğ˜€ğ—µ ğ— ğ——, ğ—® ğ˜€ğ—¶ğ—ºğ—½ğ—¹ğ—² ğ—®ğ—»ğ—± ğ—²ğ—®ğ˜€ğ˜† ğ—ªğ—µğ—®ğ˜ğ˜€ğ—”ğ—½ğ—½ ğ˜‚ğ˜€ğ—²ğ—¿ ğ—¯ğ—¼ğ˜ 
 * @ğ—¼ğ˜„ğ—»ğ—²ğ—¿: ğ—™ğ—¿ğ—®ğ—»ğ—°ğ—² ğ—ğ—¶ğ—»ğ—´ 
 
 **/








const axios = require('axios');
const { france } = require("../framework/france");
const fs = require("fs-extra");
const { exec } = require("child_process");
const child_process = require('child_process');
const {unlink } = require ('fs').promises ;


// fonction sleep

const sleep =  (ms) =>{
    return new Promise((resolve) =>{ setTimeout (resolve, ms)})
    
    } 

// Fonction pour la conversion de GIF en vidÃ©o et rÃ©cupÃ©ration du buffer vidÃ©o
const GIFBufferToVideoBuffer = async (image) => {
    const filename = `${Math.random().toString(36)}`;
    await fs.writeFileSync(`./${filename}.gif`, image);
    child_process.exec(
        `ffmpeg -i ./${filename}.gif -movflags faststart -pix_fmt yuv420p -vf "scale=trunc(iw/2)*2:trunc(ih/2)*2" ./${filename}.mp4`
    );
    await sleep(4000);
  
    var buffer5 = await fs.readFileSync(`./${filename}.mp4`);
    Promise.all([unlink(`./${filename}.mp4`), unlink(`./${filename}.gif`)]);
    return buffer5;
};

const generateReactionCommand = (reactionName, reactionEmoji) => {
    france({
        nomCom: reactionName,
        categorie: "Reaction",
        reaction: reactionEmoji,
    },
    async (origineMessage, zk, commandeOptions) => {
        const { auteurMessage, auteurMsgRepondu, repondre, ms, msgRepondu } = commandeOptions;

        const url = `https://api.waifu.pics/sfw/${reactionName}`;
        try {
            const response = await axios.get(url);
            const imageUrl = response.data.url;

            // Obtenir le buffer du GIF en utilisant la fonction getBuffer
             const gifBufferResponse = await  axios.get(imageUrl, {
                responseType: 'arraybuffer' }) ;
            const gifBuffer = await gifBufferResponse.data;

            // Convertir le GIF en vidÃ©o et obtenir le buffer vidÃ©o
            const videoBuffer = await GIFBufferToVideoBuffer(gifBuffer);

            // Envoyer la vidÃ©o avec france
            if (msgRepondu) { 
              var txt =` @${auteurMessage.split("@")[0]}  ${reactionName} @${auteurMsgRepondu.split("@")[0]}`
       zk.sendMessage(origineMessage, { video: videoBuffer,gifPlayback: true,caption:txt,mentions:[auteurMessage,auteurMsgRepondu] }, { quoted: ms });
    
            } else {
                const videoMessage = {
                    video: videoBuffer,
                    gifPlayback: true,
                    caption: `@${auteurMessage.split("@")[0]} ${reactionName} everyone`,
                    mentions: [auteurMessage]
                };
                zk.sendMessage(origineMessage, videoMessage, { quoted: ms });
            }

        } catch (error) {
            repondre('Erreur lors de la rÃ©cupÃ©ration des donnÃ©es :' + error);
            console.log(error);
        }
    });
};

// ... (utilisation de la fonction generateReactionCommand pour crÃ©er des commandes de rÃ©action)


generateReactionCommand("bully", "ğŸ‘Š");
generateReactionCommand("cuddle", "ğŸ¤—");
generateReactionCommand("cry", "ğŸ˜¢");
generateReactionCommand("hug", "ğŸ˜Š");
generateReactionCommand("awoo", "ğŸº");
generateReactionCommand("kiss", "ğŸ˜˜");
generateReactionCommand("lick", "ğŸ‘…");
generateReactionCommand("pat", "ğŸ‘‹");
generateReactionCommand("smug", "ğŸ˜");
generateReactionCommand("bonk", "ğŸ”¨");
generateReactionCommand("yeet", "ğŸš€");
generateReactionCommand("blush", "ğŸ˜Š");
generateReactionCommand("smile", "ğŸ˜„");
generateReactionCommand("wave", "ğŸ‘‹");
generateReactionCommand("highfive");
generateReactionCommand("handhold");
generateReactionCommand("nom","ğŸ‘…" );
generateReactionCommand("bite", "ğŸ¦·");
generateReactionCommand("glomp", "ğŸ¤—");
generateReactionCommand("slap", "ğŸ‘‹");
generateReactionCommand("kill", "ğŸ’€");
generateReactionCommand("kick", "ğŸ¦µ");
generateReactionCommand("happy", "ğŸ˜„");
generateReactionCommand("wink", "ğŸ˜‰");
generateReactionCommand("poke", "ğŸ‘‰");
generateReactionCommand("dance", "ğŸ’ƒ");
generateReactionCommand("cringe", "ğŸ˜¬");
